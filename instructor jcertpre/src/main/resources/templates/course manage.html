<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .card {
            border: none;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 12px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .btn-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            transition: transform 0.2s;
        }
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
        .course-card {
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        .course-card .card-img-top {
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        .course-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        .status-active {
            background: #28a745;
            color: white;
        }
        .status-draft {
            background: #ffc107;
            color: #212529;
        }
        .status-archived {
            background: #6c757d;
            color: white;
        }
        .course-meta {
            font-size: 0.875em;
            color: #6c757d;
        }
        .course-actions {
            border-top: 1px solid #dee2e6;
            padding-top: 15px;
            margin-top: 15px;
        }
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-4">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-book me-2 text-success"></i>Quản lý Khóa học</h2>
            <button class="btn btn-custom" id="add-course-btn">
                <i class="fas fa-plus me-2"></i>Thêm Khóa học
            </button>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h3 id="total-courses">0</h3>
                        <p class="mb-0">Tổng khóa học</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <h3 id="active-courses">0</h3>
                        <p class="mb-0">Đang hoạt động</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body text-center">
                        <h3 id="draft-courses">0</h3>
                        <p class="mb-0">Bản nháp</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h3 id="total-students">0</h3>
                        <p class="mb-0">Tổng học viên</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="row align-items-end">
                <div class="col-md-3">
                    <label class="form-label">Tìm kiếm khóa học</label>
                    <input type="text" class="form-control" id="search-courses" placeholder="Nhập tên khóa học...">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Trạng thái</label>
                    <select class="form-select" id="filter-status">
                        <option value="">Tất cả</option>
                        <option value="active">Hoạt động</option>
                        <option value="draft">Bản nháp</option>
                        <option value="archived">Lưu trữ</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Giảng viên</label>
                    <select class="form-select" id="filter-instructor">
                        <option value="">Tất cả</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Danh mục</label>
                    <select class="form-select" id="filter-category">
                        <option value="">Tất cả</option>
                        <option value="programming">Lập trình</option>
                        <option value="design">Thiết kế</option>
                        <option value="business">Kinh doanh</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-outline-primary" id="apply-filters">
                        <i class="fas fa-filter me-2"></i>Áp dụng
                    </button>
                    <button class="btn btn-outline-secondary ms-2" id="clear-filters">
                        <i class="fas fa-times me-2"></i>Xóa lọc
                    </button>
                </div>
            </div>
        </div>

        <!-- Courses Grid -->
        <div class="row" id="courses-container">
            <!-- Courses will be populated here -->
        </div>

        <!-- Add/Edit Course Modal -->
        <div class="modal fade" id="courseModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="course-modal-title">Thêm Khóa học mới</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="course-form">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label class="form-label">Tên khóa học *</label>
                                        <input type="text" class="form-control" id="course-name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Mô tả ngắn</label>
                                        <textarea class="form-control" id="course-description" rows="3"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Mô tả chi tiết</label>
                                        <textarea class="form-control" id="course-content" rows="6"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Ảnh khóa học</label>
                                        <input type="file" class="form-control" id="course-image" accept="image/*">
                                        <div class="mt-2">
                                            <img id="image-preview" src="" alt="Preview" style="max-width: 100%; height: 120px; object-fit: cover; display: none;" class="rounded">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Giảng viên *</label>
                                        <select class="form-select" id="course-instructor" required>
                                            <option value="">Chọn giảng viên</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Danh mục</label>
                                        <select class="form-select" id="course-category">
                                            <option value="programming">Lập trình</option>
                                            <option value="design">Thiết kế</option>
                                            <option value="business">Kinh doanh</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Thời lượng (giờ)</label>
                                        <input type="number" class="form-control" id="course-duration" min="1">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Học phí (VNĐ)</label>
                                        <input type="number" class="form-control" id="course-price" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Trạng thái</label>
                                        <select class="form-select" id="course-status">
                                            <option value="draft">Bản nháp</option>
                                            <option value="active">Hoạt động</option>
                                            <option value="archived">Lưu trữ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" form="course-form" class="btn btn-custom">Lưu khóa học</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        class CourseManagement {
            constructor() {
                this.courses = [
                    {
                        id: '001',
                        name: 'Java Spring Boot',
                        description: 'Khóa học phát triển web với Spring Boot',
                        content: 'Học cách xây dựng ứng dụng web hiện đại với Java Spring Boot...',
                        instructor: 'Nguyễn Văn An',
                        instructorId: '001',
                        category: 'programming',
                        duration: 40,
                        price: 2000000,
                        status: 'active',
                        students: 45,
                        image: 'https://via.placeholder.com/300x200/667eea/white?text=Java+Spring+Boot',
                        createdDate: '2024-01-15'
                    },
                    {
                        id: '002',
                        name: 'React JS',
                        description: 'Xây dựng giao diện với React',
                        content: 'Khóa học toàn diện về React JS và các công nghệ liên quan...',
                        instructor: 'Trần Thị Bình',
                        instructorId: '002',
                        category: 'programming',
                        duration: 35,
                        price: 1800000,
                        status: 'active',
                        students: 38,
                        image: 'https://via.placeholder.com/300x200/61dafb/white?text=React+JS',
                        createdDate: '2024-02-10'
                    },
                    {
                        id: '003',
                        name: 'Python for Beginners',
                        description: 'Khóa học Python cơ bản',
                        content: 'Học Python từ cơ bản đến nâng cao...',
                        instructor: 'Lê Văn Cường',
                        instructorId: '003',
                        category: 'programming',
                        duration: 30,
                        price: 1500000,
                        status: 'draft',
                        students: 0,
                        image: 'https://via.placeholder.com/300x200/3776ab/white?text=Python',
                        createdDate: '2024-03-05'
                    }
                ];
                this.instructors = [
                    { id: '001', name: 'Nguyễn Văn An' },
                    { id: '002', name: 'Trần Thị Bình' },
                    { id: '003', name: 'Lê Văn Cường' }
                ];
                this.editingId = null;
                this.init();
            }

            init() {
                this.bindEvents();
                this.populateInstructorOptions();
                this.renderCourses();
                this.updateStatistics();
            }

            bindEvents() {
                document.getElementById('add-course-btn').addEventListener('click', () => this.showModal());
                document.getElementById('course-form').addEventListener('submit', (e) => this.handleSubmit(e));
                document.getElementById('search-courses').addEventListener('input', (e) => this.handleSearch(e));
                document.getElementById('apply-filters').addEventListener('click', () => this.applyFilters());
                document.getElementById('clear-filters').addEventListener('click', () => this.clearFilters());
                document.getElementById('course-image').addEventListener('change', (e) => this.previewImage(e));
            }

            populateInstructorOptions() {
                const selects = document.querySelectorAll('#course-instructor, #filter-instructor');
                selects.forEach(select => {
                    if (select.id === 'filter-instructor') {
                        select.innerHTML = '<option value="">Tất cả</option>';
                    } else {
                        select.innerHTML = '<option value="">Chọn giảng viên</option>';
                    }
                    
                    this.instructors.forEach(instructor => {
                        const option = document.createElement('option');
                        option.value = instructor.id;
                        option.textContent = instructor.name;
                        select.appendChild(option);
                    });
                });
            }

            showModal(course = null) {
                this.editingId = course ? course.id : null;
                const modal = new bootstrap.Modal(document.getElementById('courseModal'));
                const title = document.getElementById('course-modal-title');
                
                if (course) {
                    title.textContent = 'Chỉnh sửa Khóa học';
                    this.populateForm(course);
                } else {
                    title.textContent = 'Thêm Khóa học mới';
                    document.getElementById('course-form').reset();
                    document.getElementById('image-preview').style.display = 'none';
                }
                
                modal.show();
            }

            populateForm(course) {
                document.getElementById('course-name').value = course.name;
                document.getElementById('course-description').value = course.description;
                document.getElementById('course-content').value = course.content;
                document.getElementById('course-instructor').value = course.instructorId;
                document.getElementById('course-category').value = course.category;
                document.getElementById('course-duration').value = course.duration;
                document.getElementById('course-price').value = course.price;
                document.getElementById('course-status').value = course.status;
                
                const preview = document.getElementById('image-preview');
                preview.src = course.image;
                preview.style.display = 'block';
            }

            handleSubmit(e) {
                e.preventDefault();
                
                const instructorId = document.getElementById('course-instructor').value;
                const instructor = this.instructors.find(i => i.id === instructorId);
                
                const formData = {
                    name: document.getElementById('course-name').value,
                    description: document.getElementById('course-description').value,
                    content: document.getElementById('course-content').value,
                    instructor: instructor ? instructor.name : '',
                    instructorId: instructorId,
                    category: document.getElementById('course-category').value,
                    duration: parseInt(document.getElementById('course-duration').value) || 0,
                    price: parseInt(document.getElementById('course-price').value) || 0,
                    status: document.getElementById('course-status').value,
                    image: document.getElementById('image-preview').src || `https://via.placeholder.com/300x200/667eea/white?text=${encodeURIComponent(document.getElementById('course-name').value)}`,
                    createdDate: new Date().toISOString().split('T')[0]
                };

                if (this.editingId) {
                    this.updateCourse(this.editingId, formData);
                } else {
                    this.addCourse(formData);
                }

                bootstrap.Modal.getInstance(document.getElementById('courseModal')).hide();
            }

            addCourse(data) {
                const newId = String(this.courses.length + 1).padStart(3, '0');
                this.courses.push({ 
                    id: newId, 
                    students: 0,
                    ...data 
                });
                this.renderCourses();
                this.updateStatistics();
                this.showNotification('Thêm khóa học thành công!', 'success');
            }

            updateCourse(id, data) {
                const index = this.courses.findIndex(c => c.id === id);
                if (index !== -1) {
                    this.courses[index] = { ...this.courses[index], ...data };
                    this.renderCourses();
                    this.updateStatistics();
                    this.showNotification('Cập nhật khóa học thành công!', 'success');
                }
            }

            deleteCourse(id) {
                if (confirm('Bạn có chắc chắn muốn xóa khóa học này?')) {
                    this.courses = this.courses.filter(c => c.id !== id);
                    this.renderCourses();
                    this.updateStatistics();
                    this.showNotification('Xóa khóa học thành công!', 'success');
                }
            }

            renderCourses() {
                const container = document.getElementById('courses-container');
                container.innerHTML = '';

                this.courses.forEach(course => {
                    const statusText = {
                        'active': 'Hoạt động',
                        'draft': 'Bản nháp',
                        'archived': 'Lưu trữ'
                    };

                    const col = document.createElement('div');
                    col.className = 'col-md-4 mb-4';
                    col.innerHTML = `
                        <div class="card course-card">
                            <div class="course-status status-${course.status}">
                                ${statusText[course.status]}
                            </div>
                            <img src="${course.image}" class="card-img-top" alt="${course.name}">
                            <div class="card-body">
                                <h5 class="card-title">${course.name}</h5>
                                <p class="card-text">${course.description}</p>
                                <div class="course-meta mb-2">
                                    <div><i class="fas fa-user me-1"></i> ${course.instructor}</div>
                                    <div><i class="fas fa-clock me-1"></i> ${course.duration} giờ</div>
                                    <div><i class="fas fa-users me-1"></i> ${course.students} học viên</div>
                                    <div><i class="fas fa-money-bill me-1"></i> ${course.price.toLocaleString('vi-VN')} VNĐ</div>
                                </div>
                                <div class="course-actions">
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="courseMgmt.showModal(${JSON.stringify(course).replace(/"/g, '&quot;')})" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info me-1" onclick="courseMgmt.viewDetails('${course.id}')" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success me-1" onclick="courseMgmt.manageStudents('${course.id}')" title="Quản lý học viên">
                                        <i class="fas fa-users"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="courseMgmt.deleteCourse('${course.id}')" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(col);
                });
            }

            updateStatistics() {
                const total = this.courses.length;
                const active = this.courses.filter(c => c.status === 'active').length;
                const draft = this.courses.filter(c => c.status === 'draft').length;
                const totalStudents = this.courses.reduce((sum, c) => sum + c.students, 0);

                document.getElementById('total-courses').textContent = total;
                document.getElementById('active-courses').textContent = active;
                document.getElementById('draft-courses').textContent = draft;
                document.getElementById('total-students').textContent = totalStudents;
            }

            handleSearch(e) {
                const searchTerm = e.target.value.toLowerCase();
                const courseCards = document.querySelectorAll('.course-card');
                
                courseCards.forEach(card => {
                    const text = card.textContent.toLowerCase();
                    const col = card.parentElement;
                    col.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }

            applyFilters() {
                const statusFilter = document.getElementById('filter-status').value;
                const instructorFilter = document.getElementById('filter-instructor').value;
                const categoryFilter = document.getElementById('filter-category').value;

                const courseCards = document.querySelectorAll('.course-card');
                
                this.courses.forEach((course, index) => {
                    const card = courseCards[index];
                    const col = card.parentElement;
                    
                    let show = true;
                    
                    if (statusFilter && course.status !== statusFilter) show = false;
                    if (instructorFilter && course.instructorId !== instructorFilter) show = false;
                    if (categoryFilter && course.category !== categoryFilter) show = false;
                    
                    col.style.display = show ? '' : 'none';
                });
            }

            clearFilters() {
                document.getElementById('filter-status').value = '';
                document.getElementById('filter-instructor').value = '';
                document.getElementById('filter-category').value = '';
                document.getElementById('search-courses').value = '';
                
                const courseCards = document.querySelectorAll('.course-card');
                courseCards.forEach(card => {
                    card.parentElement.style.display = '';
                });
            }

            previewImage(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('image-preview');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            }

            viewDetails(id) {
                const course = this.courses.find(c => c.id === id);
                if (course) {
                    alert(`Chi tiết khóa học:\n\nTên: ${course.name}\nGiảng viên: ${course.instructor}\nThời lượng: ${course.duration} giờ\nHọc phí: ${course.price.toLocaleString('vi-VN')} VNĐ\nSố học viên: ${course.students}\nTrạng thái: ${course.status}`);
                }
            }

            manageStudents(id) {
                alert(`Chức năng quản lý học viên cho khóa học ${id} đang được phát triển`);
            }

            showNotification(message, type = 'info') {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
                alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                    }
                }, 3000);
            }
        }

        // Initialize course management
        const courseMgmt = new CourseManagement();
        
        // Export for use in main app
        window.CourseManagementComponent = courseMgmt;
    </script>
</body>
</html>
