<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Exam Results</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"/>
    <style>
        body { padding: 20px; }
        .question-card { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .correct-answer-text { color: green; font-weight: bold; }
        .incorrect-answer-text { color: red; font-weight: bold; }
        .your-answer-text { font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Exam Results</h2>
        <p>Your Score: <span th:text="${score}"></span> / <span th:text="${questions.size()}"></span></p>

        <div th:each="question : ${questions}" class="question-card">
            <h5 th:text="${question.text}">Question Text</h5>
            <p>
                Option A: <span th:text="${question.optionA}"></span><br/>
                Option B: <span th:text="${question.optionB}"></span><br/>
                Option C: <span th:text="${question.optionC}"></span><br/>
                Option D: <span th:text="${question.optionD}"></span>
            </p>
            <p>
                Correct Answer: <span class="correct-answer-text" th:text="${question.correctAnswer.toUpperCase()}"></span>
            </p>
            <p>
                Your Answer:
                <span th:with="learnerAnswer=${submittedAnswers.get(question.id)}">
                    <span th:if="${learnerAnswer != null}"
                          th:class="${questionResults.get(question.id) ? 'correct-answer-text' : 'incorrect-answer-text'}"
                          th:text="${learnerAnswer.toUpperCase()}"></span>
                    <span th:unless="${learnerAnswer != null}" class="text-muted">Not answered</span>
                </span>
                <span th:if="${questionResults.containsKey(question.id) and !questionResults.get(question.id)}" class="text-danger">(Incorrect)</span>
                <span th:if="${questionResults.containsKey(question.id) and questionResults.get(question.id)}" class="text-success">(Correct)</span>
            </p>
        </div>

        <a th:href="@{/learner/course/{courseId}(courseId=${course.id})}" class="btn btn-secondary">Back to Course</a>
    </div>
</body>
</html>